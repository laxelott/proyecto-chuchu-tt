doctype html
html(lang='en')
  head
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0') 
    link(rel='stylesheet', href='../stylesheets/dashboard.css') 
    link(rel='preconnect', href='https://fonts.googleapis.com')
    link(rel='preconnect', href='https://fonts.gstatic.com', crossorigin)
    link(href='https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap', rel='stylesheet')
    link(rel='stylesheet', href='https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css')
    script(src='https://code.jquery.com/jquery-3.6.0.min.js')
    script(src='https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js')
    script.
      $(document).ready(function() {
        $('#transportsTable, #routesTable, #vehiclesTable, #driversTable, #stopsTable').DataTable();

        // Form submissions
        ['Transport', 'Route', 'Vehicle', 'Driver', 'Stop'].forEach(form => {
          $(`#add${form}Form`).submit(function(e) {
            e.preventDefault();
            $.post(`/api/admin/create${form}`, $(this).serialize(), function(response) {
              alert(response.message);
              location.reload();
            });
          });
        });

        // Lógica para mostrar la tabla seleccionada
        $('li').click(function() {
          var target = $(this).data('target');
          $('section').hide(); // Ocultar todas las secciones
          $(target).show(); // Mostrar la sección seleccionada
        });

        // Mostrar la primera tabla por defecto
        $('section').hide(); 
        $('#transports').show(); 

        // Logout del admin
        document.getElementById('logoutAdminForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const token = localStorage.getItem('adminToken'); // Asumiendo que el token está guardado en localStorage
            
            $.post('/api/admin/logoutadmin', { token }, function(response) {
              alert(response.message);
              window.location.href = '/loginadmin'; // Redirigir al login tras el logout
            });
        });
      })
    title Tablero de Administración
  body
    header
      .logo
          img(src='../icons/location.svg', alt='Logo')
          span Nintrip
      .nav
        a(href='/') Inicio
        a(href='./pasajero') Pasajero
        a(href='./conductor') Conductor
        a(href='./admin_view') Prueba de front
        form#logoutAdminForm(method="POST", action="/api/admin/logoutadmin")
          button(type="submit") Logout
    aside.sidebar
      ul
        li(data-target='#transports') Transporte
        li(data-target='#routes') Rutas
        li(data-target='#vehicles') Vehículos
        li(data-target='#drivers') Conductores
        li(data-target='#stops') Paradas

main.content
  section#transports
      h2 Transporte
      table#transportsTable
        thead
          tr
            th Id Transporte
            th Nombre del transporte
            th Imagen
            th Borrar
        tbody
          //-each transport in transports
            tr
              td= transport.idTransport
              td= transport.name
              td= transport.iconB64
              td 
                button Delete
          tr
            th 1
            th Example Transport
            th (icon here)
            th 
                  button Delete

      form#addTransportForm
        input(type='text', name='name', placeholder='Nombre Transporte')
        input(type='file', name='iconB64', placeholder='Icono Transporte')
        button(type='submit') Añadir Transporte

      // Routes Table
  section#routes
      h2 Rutas
      table#routesTable
        thead
          tr
            th ID Ruta
            th ID Transporte
            th Nombre de la ruta
            th Descripcion
            th Color
            th Icon
            th Borrar
        tbody
            //-  each route in routes
                tr
                  td= route.idRoute
                  td= route.name
                  td= route.description
                  td= route.color
                  td= route.iconB64
                  td 
                    button Delete
          tr
            th 1
            th 3
            th Linea 8
            th CircuitoPolitc
            th FF2B78E4
            //th (icon here)
              th 
                  button Delete

      form#addRouteForm
        input(type='number', name='idTransport', placeholder='ID Transporte')
        input(type='text', name='name', placeholder='Nombre Ruta')
        input(type='text', name='description', placeholder='Descripcion Ruta')
        input(type='text', name='color', placeholder='Color Ruta')
        //input(type='file', name='iconB64', placeholder='Icono Ruta')
        button(type='submit') Añadir ruta

  section#stops
      // Stops Table
      h2 Estaciones
      table#stopsTable
        thead
          tr
            th ID Estacion
            th ID Ruta
            th Nombre estación
            th Latitud
            th Longitud
            th Distancia (m)
            th Siguiente estacion (ID)
            //th Icono
            th Borrar
        tbody
          //-  each stop in stops
              tr
                td= stop.idStop
                td= stop.name
                td= `${stop.lon}, ${stop.lat}`
                td 
                  button Delete
          tr
            th 1
            th 2
            th Example Stop
            th 19.4326
            th -99.1332 
            th 66.7
            th 2
            th 
              button Delete       
      form#addStopForm
        input(type='text', name='name', placeholder='Nombre estación')
        input(type='number', step='any', name='lon', placeholder='Latitud')
        input(type='number', step='any', name='lat', placeholder='Longitud')
        input(type='number', step='any', name='lat', placeholder='Distancia')
        //input(type='file', name='iconB64', placeholder='Icono')
        input(type='number', name='idRoute', placeholder='Id Ruta')
        button(type='submit') Añadir Estacion

      // Vehicles Table
  section#vehicles
      h2 Vehiculos
      table#vehiclesTable
        thead
          tr
            th ID
            th Identificador de Vehiculo
            th ID Ruta
            th Ruta
            th ID Conductor 
            th Username
            //th Driver Token
            th Borrar
        tbody
          //-  each vehicle in vehicles
              tr
                td= vehicle.idVehicle
                td= vehicle.identifier
                td= vehicle.driverToken
                td 
                  button Delete
          tr
            th 1
            th Example Vehicle
            th 60
            th CircuitoPolitc
            th 5
            th SAVIO001122
            th 
              button Delete       


      form#addVehicleForm
        input(type='text', name='id', placeholder='ID Vehiculo')
        input(type='text', name='identifier', placeholder='Identificador')
        input(type='text', name='idruta', placeholder='ID Ruta')
        input(type='text', name='idcondutr', placeholder='ID Conductor')
        //input(type='text', name='driverToken', placeholder='Driver Token (Optional)')
        button(type='submit') Añadir vehiculo

      // Drivers Table
  section#drivers
      h2 Drivers
      table#driversTable
        thead
          tr
            th ID Conductor
            th CURP
            th Nombre
            th Apellido Paterno
            th Apellido Materno
            th Username
            //th Password
            th Telefono
            th Activo
            th Borrar
        tbody
          //-  each driver in drivers
              tr
                td= driver.idDriver
                td= driver.name
                td= driver.username
                td= driver.phone
                td 
                  button Delete
          tr
            th 1
            th SAVIO0001
            th Isaac
            th Sánchez
            th Verdiguel
            th exampleUser
            //th trabajoT123
            th 5566778899
            th 1

            th 
                  button Delete 

      form#addDriverForm
        input(type='text', name='curp', placeholder='CURP')
        input(type='text', name='name', placeholder='Nombre')
        input(type='text', name='surnameP', placeholder='Apellido Paterno')
        input(type='text', name='surnameM', placeholder='Apellido Materno')
        input(type='text', name='username', placeholder='Username')
        //input(type='text', name='password', placeholder='Password')
        input(type='text', name='phone', placeholder='Telefono')
        input(type='number', name='status', placeholder='Estatus')
        button(type='submit') Añadir Conductor
    footer
      .logo
        img(src='../icons/location-white.svg', alt='Logo')
        span Nintrip
      .school
        h1 Instituto Politécnico Nacional
        br
        h1 Escuela Superior de Cómputo